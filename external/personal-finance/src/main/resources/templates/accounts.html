<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title th:text="#{accounts.title}">Accounts</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" th:href="@{/css/tables.css}"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"/>
    <link rel="icon" type="image/png" href="/images/my-logo.png" th:href="@{/images/my-logo.png}"/>
</head>
<body>
<div th:replace="blocks/header.html :: menu"></div>

<main class="container mt-5">

    <div class="d-flex flex-wrap gap-3 justify-content-between align-items-end">
        <div>
            <h1 class="mb-0" th:text="#{accounts.title}">Accounts</h1>
            <p class="text-muted mb-0" th:text="#{accounts.subtitle}"
               th:if="${#messages.msgOrNull('accounts.subtitle')} != null">
                Keep an eye on all of your balances.
            </p>
        </div>
        <div class="d-flex flex-column align-items-end gap-2 text-muted">
            <span class="badge badge-soft d-inline-flex align-items-center gap-2">
                <i class="bi bi-currency-exchange"></i>
                <span th:text="${baseCurrency}">USD</span>
            </span>
            <a class="btn md-btn md-btn-primary" href="/accounts/add" role="button" th:text="#{accounts.addNew}">
                Add new account
            </a>
            <a class="btn md-btn md-btn-outline-primary" href="/transfers/add" role="button"
               th:text="#{transfers.addNew} ?: 'Add transfer'">
                Add transfer
            </a>
        </div>
    </div>

    <div class="table-responsive table-responsive-card mt-4">
        <table class="table table-hover table-zebra table-card table-sticky align-middle">
            <thead class="bg-light">
            <tr>
                <th scope="col" th:text="#{accounts.table.name}">Name</th>
                <th scope="col" th:text="#{accounts.table.type}">Type</th>
                <th scope="col" th:text="#{accounts.table.currency}">Currency</th>
                <th scope="col" th:text="#{accounts.table.balance}">Balance</th>
                <th scope="col" th:text="#{accounts.table.balanceBase(${baseCurrency})}">Balance (USD)</th>
                <th scope="col" class="text-end text-nowrap"
                    th:text="${#messages.msgOrNull('common.actions')} ?: 'Actions'">Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="el, st : ${accounts}" th:classappend="${st.even} ? 'fw-normal' : ''">
                <td th:data-label="#{accounts.table.name}">
                    <a class="text-decoration-none" th:text="${el.name}" th:href="'/accounts/' + ${el.id}"></a>
                </td>
                <td th:data-label="#{accounts.table.type}" th:text="${el.type}"></td>
                <td th:data-label="#{accounts.table.currency}" th:text="${el.currency}"></td>
                <td th:data-label="#{accounts.table.balance}"
                    th:classappend="${el.balance < 0 ? ' text-danger' : ' text-success'}">
                    <span th:text="|${#numbers.formatDecimal(el.balance, 1, 'COMMA', 2, 'POINT')} ${el.currency}|"></span>
                </td>
                <td th:data-label="#{accounts.table.balanceBase(${baseCurrency})}" >
                    <span th:text="|${#numbers.formatDecimal(el.balanceInBase, 1, 'COMMA', 2, 'POINT')} ${baseCurrency}|"></span>
                </td>
                <td th:data-label="${#messages.msgOrNull('common.actions')} ?: 'Actions'"
                    class="text-end text-nowrap table-card-actions">
                    <div class="table-action-buttons">
                        <a class="btn btn-sm btn-outline-primary"
                           th:href="@{/accounts/{id}(id=${el.id})}"
                           onclick="event.stopPropagation();">
                            <i class="bi bi-pencil-square"></i>
                            <span class="visually-hidden" th:text="#{common.edit}">Edit</span>
                        </a>
                        <form th:action="@{/accounts/{id}(id=${el.id})}" th:method="delete" class="d-inline"
                              onclick="event.stopPropagation();">
                            <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}"
                                   th:value="${_csrf.token}"/>
                            <button type="submit" class="btn btn-sm btn-outline-danger">
                                <i class="bi bi-trash"></i>
                                <span class="visually-hidden" th:text="#{common.delete}">Delete</span>
                            </button>
                        </form>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <section class="mt-5">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
                <h2 class="h4 mb-0" th:text="#{accounts.transfers.title} ?: 'Transfers'">Transfers</h2>
                <p class="text-muted mb-0" th:text="#{accounts.transfers.subtitle} ?: 'Latest account transfers.'"></p>
            </div>
            <a class="btn btn-sm btn-outline-primary" href="/transfers/add"
               th:text="#{transfers.addNew} ?: 'Add transfer'">Add transfer</a>
        </div>

        <div class="table-responsive table-responsive-card">
            <table class="table table-hover table-card align-middle">
                <thead class="bg-light">
                <tr>
                    <th scope="col" th:text="#{accounts.transfers.table.date} ?: 'Date'">Date</th>
                    <th scope="col" th:text="#{accounts.transfers.table.from} ?: 'From account'">From account</th>
                    <th scope="col" th:text="#{accounts.transfers.table.to} ?: 'To account'">To account</th>
                    <th scope="col" th:text="#{accounts.transfers.table.amount} ?: 'Amount'">Amount</th>
                    <th scope="col" th:text="#{accounts.transfers.table.amountBase(${baseCurrency})} ?: 'Amount (base)'">Amount (base)</th>
                    <th scope="col" class="text-end" th:text="${#messages.msgOrNull('common.actions')} ?: 'Actions'">Actions</th>
                </tr>
                </thead>
                <tbody>
                <tr th:if="${transfers == null or transfers.isEmpty()}">
                    <td colspan="6" class="text-center text-muted" th:text="#{accounts.transfers.empty} ?: 'No transfers yet.'">
                        No transfers yet.
                    </td>
                </tr>
                <tr th:each="transfer : ${transfers}" th:classappend="${transfer.amount != null && transfer.amount.signum() < 0} ? 'text-danger'">
                    <td th:data-label="#{accounts.transfers.table.date} ?: 'Date'"
                        th:text="${transfer.formattedDate} ?: '-'">2024-01-01 12:00:00</td>
                    <td th:data-label="#{accounts.transfers.table.from} ?: 'From account'">
                        <span th:text="${transfer.fromAccount != null ? transfer.fromAccount.name : '-'}"></span>
                    </td>
                    <td th:data-label="#{accounts.transfers.table.to} ?: 'To account'">
                        <span th:text="${transfer.toAccount != null ? transfer.toAccount.name : '-'}"></span>
                    </td>
                    <td th:data-label="#{accounts.transfers.table.amount} ?: 'Amount'">
                        <span th:text="${transfer.amount != null ? #numbers.formatDecimal(transfer.amount, 1, 'COMMA', 2, 'POINT') : '0.00'}"></span>
                        <span th:text="${transfer.currency != null ? transfer.currency : ''}"></span>
                    </td>
                    <td th:data-label="#{accounts.transfers.table.amountBase(${baseCurrency})} ?: 'Amount (base)'">
                        <span th:text="${transfer.amountInBase != null ? #numbers.formatDecimal(transfer.amountInBase, 1, 'COMMA', 2, 'POINT') : '0.00'}"></span>
                        <span th:text="${baseCurrency}"></span>
                    </td>
                    <td th:data-label="${#messages.msgOrNull('common.actions')} ?: 'Actions'" class="text-end text-nowrap table-card-actions">
                        <div class="table-action-buttons">
                            <a class="btn btn-sm btn-outline-primary" th:href="@{/transfers/{id}(id=${transfer.id})}"
                               onclick="event.stopPropagation();">
                                <i class="bi bi-pencil-square"></i>
                                <span class="visually-hidden" th:text="#{common.edit} ?: 'Edit'">Edit</span>
                            </a>
                            <form th:action="@{/transfers/{id}(id=${transfer.id})}" th:method="delete" class="d-inline"
                                  onclick="event.stopPropagation();">
                                <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}"
                                       th:value="${_csrf.token}"/>
                                <button type="submit" class="btn btn-sm btn-outline-danger">
                                    <i class="bi bi-trash"></i>
                                    <span class="visually-hidden" th:text="#{common.delete} ?: 'Delete'">Delete</span>
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <nav th:if="${transferTotalPages != null and transferTotalPages > 1}" class="mt-3">
            <ul class="pagination justify-content-end">
                <li class="page-item" th:classappend="${currentTransferPage <= 1} ? ' disabled'">
                    <a class="page-link" href="#"
                       th:href="@{/accounts(transferPage=${currentTransferPage - 1 < 1 ? 1 : currentTransferPage - 1})}"
                       aria-label="Previous">&laquo;</a>
                </li>
                <li class="page-item" th:each="pageNum : ${#numbers.sequence(1, transferTotalPages)}"
                    th:classappend="${pageNum == currentTransferPage} ? ' active'">
                    <a class="page-link" th:href="@{/accounts(transferPage=${pageNum})}" th:text="${pageNum}">1</a>
                </li>
                <li class="page-item" th:classappend="${currentTransferPage >= transferTotalPages} ? ' disabled'">
                    <a class="page-link" href="#"
                       th:href="@{/accounts(transferPage=${currentTransferPage + 1 > transferTotalPages ? transferTotalPages : currentTransferPage + 1})}"
                       aria-label="Next">&raquo;</a>
                </li>
            </ul>
        </nav>
    </section>

</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>
</body>
</html>
