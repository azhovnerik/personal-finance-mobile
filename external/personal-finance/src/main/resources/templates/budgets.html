<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title th:text="#{budgets.title}">Budgets</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet"/>
    <link rel="stylesheet" th:href="@{/css/dashboard.css}"/>
    <link rel="stylesheet" th:href="@{/css/tables.css}"/>
    <link rel="icon" type="image/svg+xml" href="/images/favicon.svg" th:href="@{/images/favicon.svg}"/>
    <link rel="icon" type="image/png" href="/images/my-logo.png" th:href="@{/images/my-logo.png}"/>
</head>
<body class="dashboard-body"
      data-confirm-delete-title="Confirm deletion"
      data-confirm-delete-message="Are you sure you want to delete this item?"
      data-confirm-delete-confirm="Delete"
      data-confirm-delete-cancel="Cancel"
      th:attr="data-confirm-delete-title=#{common.confirmDeletionTitle}, data-confirm-delete-message=#{common.confirmDeletionMessage}, data-confirm-delete-confirm=#{common.delete}, data-confirm-delete-cancel=#{common.cancel}">
<div th:replace="blocks/header.html :: menu"></div>

<main class="container py-4">
    <div class="table-toolbar flex-column flex-lg-row align-items-start align-items-lg-center">
        <div>
            <h1 class="mb-2" th:text="#{budgets.title}">Budgets</h1>
            <p class="text-muted mb-0" th:if="${totalPages > 0}"
               th:text="#{pagination.pageOf(${currentPage}, ${totalPages})}">Page 1 of 1</p>
        </div>
        <div class="toolbar-actions">
            <a class="btn md-btn md-btn-primary" href="/budgets/add" role="button" th:text="#{budgets.add}">Add new budget</a>
        </div>
    </div>

    <div class="table-responsive table-responsive-card">
        <table class="table table-hover table-zebra table-card align-middle">
            <thead>
            <tr>
                <th scope="col" th:text="#{budgets.table.month}">Month</th>
                <th scope="col" class="text-end" th:text="#{budgets.table.totalIncome}">Total income</th>
                <th scope="col" class="text-end" th:text="#{budgets.table.totalExpenses}">Total expenses</th>
                <th scope="col" class="text-end text-nowrap"
                    th:text="${#messages.msgOrNull('common.actions')} ?: 'Actions'">Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="el : ${budgets}">
                <td th:data-label="#{budgets.table.month}">
                    <div class="d-flex align-items-center gap-3">
                        <span class="budget-icon">
                            <i class="bi bi-calendar3"></i>
                        </span>
                        <div class="d-flex flex-column">
                            <a class="text-decoration-none fw-semibold" th:text="${el.month}"
                               th:href="'/budgets/' + ${el.id}">January 2024</a>
                            <span class="text-muted small" th:if="${el.baseCurrency != null or el.user?.baseCurrency != null}"
                                  th:text="${el.baseCurrency != null ? el.baseCurrency : el.user?.baseCurrency}">USD</span>
                        </div>
                    </div>
                </td>
                <td th:data-label="#{budgets.table.totalIncome}" class="text-end">
                    <span th:text="|${#numbers.formatDecimal(el.totalIncome, 1, 'COMMA', 2, 'POINT')} ${el.baseCurrency != null ? el.baseCurrency : el.user?.baseCurrency}|"></span>
                </td>
                <td th:data-label="#{budgets.table.totalExpenses}" class="text-end">
                    <span th:text="|${#numbers.formatDecimal(el.totalExpense, 1, 'COMMA', 2, 'POINT')} ${el.baseCurrency != null ? el.baseCurrency : el.user?.baseCurrency}|"></span>
                </td>
                <td th:data-label="${#messages.msgOrNull('common.actions')} ?: 'Actions'"
                    class="text-end table-card-actions">
                    <div class="table-action-buttons">
                        <a class="btn btn-sm btn-outline-primary"
                           th:href="@{/budgets/{id}(id=${el.id})}"
                           onclick="event.stopPropagation();">
                            <i class="bi bi-pencil-square"></i>
                            <span class="visually-hidden" th:text="#{common.edit}">Edit</span>
                        </a>
                        <a class="btn btn-sm btn-outline-secondary"
                           th:href="@{/budgets/{id}/copy(id=${el.id})}"
                           onclick="event.stopPropagation();">
                            <i class="bi bi-files"></i>
                            <span class="visually-hidden" th:text="#{budget.details.clone}">Clone</span>
                        </a>
                        <form th:action="@{/budgets/{id}(id=${el.id})}" th:method="delete" class="d-inline"
                              data-confirm-delete
                              onclick="event.stopPropagation();">
                            <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}"
                                   th:value="${_csrf.token}"/>
                            <button type="submit" class="btn btn-sm btn-outline-danger">
                                <i class="bi bi-trash"></i>
                                <span class="visually-hidden" th:text="#{budget.details.delete}">Delete</span>
                            </button>
                        </form>
                    </div>
                </td>
            </tr>
            <tr th:if="${#lists.isEmpty(budgets)}">
                <td colspan="4" class="text-center text-muted py-4" th:text="#{dashboard.budgets.empty}">
                    You don't have any budgets for this month yet.
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <nav class="mt-3" th:if="${totalPages > 1}" th:attr="aria-label=#{budgets.pagination.aria}">
        <ul class="pagination justify-content-center">
            <li class="page-item" th:classappend="${currentPage == 1} ? ' disabled'">
                <a class="page-link" aria-label="Previous"
                   th:href="@{/budgets(page=${currentPage - 1})}">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>
            <li class="page-item"
                th:each="pageNum : ${#numbers.sequence(1, totalPages)}"
                th:classappend="${pageNum == currentPage} ? ' active'">
                <a class="page-link" th:href="@{/budgets(page=${pageNum})}" th:text="${pageNum}">1</a>
            </li>
            <li class="page-item" th:classappend="${currentPage == totalPages} ? ' disabled'">
                <a class="page-link" aria-label="Next"
                   th:href="@{/budgets(page=${currentPage + 1})}">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
        </ul>
    </nav>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>
<script defer th:src="@{/js/confirm-delete.js}"></script>
</body>
</html>
