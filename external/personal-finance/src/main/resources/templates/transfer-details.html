<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title th:text="#{transfers.form.edit.title} ?: 'Edit transfer'">Edit transfer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link href="/css/dashboard.css" rel="stylesheet">
    <link rel="icon" type="image/png" href="/images/my-logo.png" th:href="@{/images/my-logo.png}"/>
</head>
<body data-confirm-delete-title="Confirm deletion"
      data-confirm-delete-message="Are you sure you want to delete this item?"
      data-confirm-delete-confirm="Delete"
      data-confirm-delete-cancel="Cancel"
      th:attr="data-confirm-delete-title=#{common.confirmDeletionTitle}, data-confirm-delete-message=#{common.confirmDeletionMessage}, data-confirm-delete-confirm=#{common.delete}, data-confirm-delete-cancel=#{common.cancel}">
<div th:replace="blocks/header.html :: menu"></div>

<main class="container mt-5 mb-3">
    <h1 th:text="#{transfers.form.edit.heading} ?: 'Edit transfer'">Edit transfer</h1>

    <form th:object="${transfer}" th:action="@{/transfers/{id}(id=${transfer.id})}" th:method="put" class="mt-4">
        <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

        <div class="mb-3">
            <label for="transfer-date" class="form-label" th:text="#{transfers.form.date.label} ?: 'Date'">Date</label>
            <input type="text" id="transfer-date" th:field="*{date}" name="date"
                   class="form-control bg-white datepicker" data-enable-time="true" data-enable-seconds="true"
                   th:placeholder="#{transfers.form.date.placeholder} ?: 'YYYY-MM-DD HH:mm:ss'">
            <div class="md-text-danger" th:if="${#fields.hasErrors('date')}" th:errors="*{date}"></div>
        </div>

        <div class="mb-3">
            <label for="from-account" class="form-label" th:text="#{transfers.form.fromAccount.label} ?: 'From account'">From account</label>
            <select id="from-account" class="form-select" th:field="*{fromAccountId}">
                <option value="" disabled th:selected="*{fromAccountId} == null"
                        th:text="#{transfers.form.fromAccount.placeholder} ?: 'Select account'"></option>
                <option th:each="account : ${accounts}" th:value="${account.id}"
                        th:text="${account.name + ' (' + account.currency + ')'}"
                        th:selected="${account.id == transfer.fromAccountId}"></option>
            </select>
            <div class="md-text-danger" th:if="${#fields.hasErrors('fromAccountId')}" th:errors="*{fromAccountId}"></div>
        </div>

        <div class="mb-3">
            <label for="to-account" class="form-label" th:text="#{transfers.form.toAccount.label} ?: 'To account'">To account</label>
            <select id="to-account" class="form-select" th:field="*{toAccountId}">
                <option value="" disabled th:selected="*{toAccountId} == null"
                        th:text="#{transfers.form.toAccount.placeholder} ?: 'Select account'"></option>
                <option th:each="account : ${accounts}" th:value="${account.id}"
                        th:text="${account.name + ' (' + account.currency + ')'}"
                        th:selected="${account.id == transfer.toAccountId}"></option>
            </select>
            <div class="md-text-danger" th:if="${#fields.hasErrors('toAccountId')}" th:errors="*{toAccountId}"></div>
        </div>

        <div class="mb-3">
            <label for="amount" class="form-label" th:text="#{transfers.form.amount.label} ?: 'Amount'">Amount</label>
            <input type="number" step="0.01" min="0.01" id="amount" th:field="*{amount}" class="form-control"
                   th:placeholder="#{transfers.form.amount.placeholder} ?: 'Amount to transfer'">
            <small class="text-muted" th:if="${baseCurrency != null}"
                   th:text="#{transfers.form.amount.hint(${baseCurrency})} ?: 'Amount will be saved in the account currency.'">
                Amount will be saved in the account currency.
            </small>
            <div class="md-text-danger" th:if="${#fields.hasErrors('amount')}" th:errors="*{amount}"></div>
        </div>

        <div class="mb-4">
            <label for="comment" class="form-label" th:text="#{transfers.form.comment.label} ?: 'Comment'">Comment</label>
            <input type="text" id="comment" th:field="*{comment}" class="form-control"
                   th:placeholder="#{transfers.form.comment.placeholder} ?: 'Optional comment'">
            <div class="md-text-danger" th:if="${#fields.hasErrors('comment')}" th:errors="*{comment}"></div>
        </div>

        <div class="md-text-danger" th:if="${#fields.hasGlobalErrors()}" th:each="err : ${#fields.globalErrors()}"
             th:text="${err}"></div>

        <div th:if="${errorMessage}" class="alert alert-danger" role="alert" th:text="${errorMessage}"></div>

        <button type="submit" class="btn md-btn md-btn-success" th:text="#{common.save} ?: 'Save'">Save</button>
        <a class="btn md-btn md-btn-secondary" th:href="@{/accounts}" th:text="#{common.cancel} ?: 'Cancel'">Cancel</a>
    </form>

    <form th:action="@{/transfers/{id}(id=${transfer.id})}" th:method="delete" class="mt-3" data-confirm-delete>
        <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
        <button type="submit" class="btn md-btn md-btn-danger" th:text="#{common.delete} ?: 'Delete'">Delete</button>
    </form>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>
<script defer th:src="@{/js/confirm-delete.js}"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script type="text/javascript">
    const dateInput = document.getElementById('transfer-date');
    if (dateInput) {
        flatpickr(dateInput, {
            enableTime: true,
            dateFormat: 'Y-m-d H:i:S',
            enableSeconds: true,
            disableMobile: true
        });
    }
</script>
</body>
</html>
